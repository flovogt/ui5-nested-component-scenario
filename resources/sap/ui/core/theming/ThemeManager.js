/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/assert","sap/base/Eventing","sap/base/future","sap/base/Log","sap/base/i18n/Localization","sap/base/util/each","sap/base/util/LoaderExtensions","sap/ui/Device","sap/ui/VersionInfo","sap/ui/core/Lib","sap/ui/core/Theming","sap/ui/core/theming/ThemeHelper","sap/ui/dom/includeStylesheet"],function(e,t,r,a,i,s,n,o,u,c,l,d,h){"use strict";const f=new t;const m=150;const p={};const g=/\.sapUiThemeDesignerCustomCss/i;const v="sap-ui-core-customcss";const T="sap-ui-theme-";let b;let y=true;document.querySelectorAll(`link[id^=${T}]`).forEach(function(e){let t=true;const r=e.getAttribute("id").replace(T,"");b??=e.getAttribute("href").match(/.*sap-ui-dist-version=([^?&]*)/)?.[1];p[r]={version:b};e.removeAttribute("data-sap-ui-ready");a.info(`ThemeManager: Preloaded CSS for library ${r} detected: ${e.href}`,undefined,"sap.ui.core.theming.ThemeManager");try{t=!!(e.sheet?.href===e.href&&e.sheet?.cssRules);if(!t){y=t;e.addEventListener("load",t=>{const r=t.type==="error";e.setAttribute("data-sap-ui-ready",!r)})}else{e.setAttribute("data-sap-ui-ready",e.sheet.cssRules.length>0)}}catch(t){a.info("Could not detect ready state of preloaded CSS. Request stylesheet again to verify the response status",undefined,"sap.ui.core.theming.ThemeManager");y=false;h({url:e.href,id:e.getAttribute("id")})}});let L=0;let A=false;let C=null;let S=null;let E={};let R;var U={themeLoaded:y,checkThemeApplied:function(){U.reset();w(true);if(!R){U.fireThemeApplied()}},reset:function(){U.themeLoaded=false;if(R){clearTimeout(R);R=null;L=0;S=null;E={}}},_includeLibraryThemeAndEnsureThemeRoot:function(e){var t=e.name;I(t,l.getTheme());I(t,"base");const r=`${t}${e.variant?"-["+e.variant+"]":""}`;e.preloadedCss=e.preloadedCss||!!p[r];p[r]=e;if(!e.preloadedCss){U.includeLibraryTheme(t,e.variant,e)}},includeLibraryTheme:function(t,r,s){e(typeof t==="string","sLibName must be a string");e(r===undefined||typeof r==="string","sVariant must be a string or undefined");var n=s;if(typeof n==="object"){n=P(s)}if(t==="sap.ui.legacy"||t==="sap.ui.classic"){return}if(!r){r=""}var o=i.getRTL()?"-RTL":"";var u,c=t+(r.length>0?"-["+r+"]":r);if(t&&t.indexOf(":")==-1){u="library"+r+o}else{u=t.substring(t.indexOf(":")+1)+r;t=t.substring(0,t.indexOf(":"))}const d=`${T}${c}`;if(!document.querySelector("LINK[id='"+d+"']")){var f=new URL(U._getThemePath(t,l.getTheme()),document.baseURI).toString();var m=document.createElement("link");m.href=f+u+".css"+(n?n:"");var p=m.href;x(d);a.info("Including "+p+" -  sap.ui.core.theming.ThemeManager.includeLibraryTheme()");h(p,d);var g=sap.ui.require("sap/ui/core/theming/Parameters");if(g){g._addLibraryTheme(c)}U.checkThemeApplied()}},_getThemePath:function(e,t){I(e,t);return sap.ui.require.toUrl((e+".themes."+t).replace(/\./g,"/")+"/")},_updateThemeUrls:function(e,t){var r=document.querySelectorAll(`link[id^=${T}]`);Array.prototype.forEach.call(r,function(r){M(r,e,t)})},_attachThemeApplied:function(e){f.attachEvent("applied",e)},_detachThemeApplied:function(e){f.detachEvent("applied",e)},fireThemeApplied:function(){d.reset();var e=sap.ui.require("sap/ui/core/theming/Parameters");if(e){e._reset(true)}f.fireEvent("applied",{theme:l.getTheme()})}};function $(){var e=l.getTheme();var t=U._getThemePath("sap.ui.core",e)+"custom.css";var r=d.isStandardTheme(l.getTheme());var i=true;var n=[];if(A&&C===e){p[v]={}}function o(s){var o=d.checkAndRemoveStyle({prefix:T,id:s});i=i&&o;if(i){if(!A||C!=e){if(!r&&k(s)){var u=t;var c=P(p["sap.ui.core"]);if(c){u+=c}h(u,v);A=true;a.debug("ThemeManager: delivered custom CSS needs to be loaded, Theme not yet applied");C=e;i=false;return false}else if(A){var l=document.querySelector("LINK[id='"+v+"']");if(l){l.remove();a.debug("ThemeManager: Custom CSS removed")}A=false}}}if(!r&&o&&!E[s]){var f=document.getElementById(`${T}${s}`);if(f&&f.getAttribute("data-sap-ui-ready")==="false"&&!(f.sheet&&d.hasSheetCssRules(f.sheet))){n.push(s)}}}s(p,o);if(n.length>0){if(!S){for(var u in p){var c=d.getMetadata(u);if(c&&c.Extends&&c.Extends[0]){S=c.Extends[0]}else{const t=l.getThemeRoot(e,u);if(t){const e=/~v=[^\/]+\(([a-zA-Z0-9_]+)\)/;S=e.exec(t)?.[1];if(S){S=d.validateAndFallbackTheme(S)}}}if(S){break}}}if(S){n.forEach(function(t){const r=document.getElementById(`${T}${t}`);a.warning("ThemeManager: Custom theme '"+e+"' could not be loaded for library '"+t+"'. "+"Falling back to its base theme '"+S+"'.");M(r,S);E[t]=true});i=false}}if(!i){a.debug("ThemeManager: Theme not yet applied.")}else{C=e}return i}function k(e){var t=window.document.getElementById(`${T}${e}`);if(!t){return false}var i=window.getComputedStyle(t,":after");var s=i?i.getPropertyValue("content"):null;if(!s&&o.browser.safari){var n=document.documentElement;n.classList.add("sapUiThemeDesignerCustomCss");s=window.getComputedStyle(n,":after").getPropertyValue("content");n.classList.remove("sapUiThemeDesignerCustomCss")}if(s&&s!=="none"){try{if(s[0]==="'"||s[0]==='"'){s=s.substring(1,s.length-1)}return s==="true"}catch(e){r.errorThrows("Custom check: Error parsing JSON string for custom.css indication.",{cause:e})}}var u=t.sheet?d.safeAccessSheetCssRules(t.sheet):null;if(!u||u.length===0){a.warning("Custom check: Failed retrieving a CSS rule from stylesheet "+e);return false}for(var c=0;c<2&&c<u.length;c++){if(g.test(u[c].selectorText)){return true}}return false}function w(e){L++;var t=L>m;if(!$()&&!t){var a;if(L<=100){a=2}else if(L<=110){a=500}else{a=1e3}R=setTimeout(w,a)}else if(!e){U.reset();U.themeLoaded=true;U.fireThemeApplied();if(t){r.errorThrows("ThemeManager: max. check cycles reached.")}}else{U.themeLoaded=true}}function x(e){var t=document.getElementById(e);if(t){t.dataset.sapUiFoucmarker=e}}function _(e){var t=document.documentElement;var r=e.new;U._updateThemeUrls(r,true);t.classList.remove("sapUiTheme-"+e.old);t.classList.add("sapUiTheme-"+r);U.checkThemeApplied()}function I(e,t){var r=l.getThemeRoot(t,e);if(r){r=r+(r.slice(-1)=="/"?"":"/")+e.replace(/\./g,"/")+"/themes/"+t+"/";n.registerResourcePath((e+".themes."+t).replace(/\./g,"/"),r)}}function M(e,t,r){var a,s=e.href.search(/[?#]/),n,o,u="library",c=i.getRTL()?"-RTL":"",l,d;var f=new RegExp(`^${T}(.*)$`,"i").exec(e.id);if(Array.isArray(f)){a=f[1]}else{a=e.id.slice(T.length)}p[a]=p[a]||{};if(s>-1){n=e.href.substring(0,s);o=e.href.substring(s)}else{n=e.href;o=""}n=n.substring(n.lastIndexOf("/")+1);if((d=a.indexOf("-["))>0){u+=a.slice(d+2,-1);a=a.slice(0,d)}if(n===u+".css"||n===u+"-RTL.css"){n=u+c+".css"}l=new URL(U._getThemePath(a,t)+n+o,document.baseURI).toString();if(l!=e.href){if(r){e.dataset.sapUiFoucmarker=e.id}h(l,e.id)}}function P(e){var t;if(e){t="?version="+e.version;if(u._content||b){t+=`&sap-ui-dist-version=${u._content?.version||b}`}}return t}document.documentElement.classList.add("sapUiTheme-"+l.getTheme());a.info("Declared theme "+l.getTheme(),null);l.attachChange(function(e){var t=e.themeRoots;var r=e.theme;if(t&&t.forceUpdate){U._updateThemeUrls(l.getTheme())}if(r){_(r)}});l.registerThemeManager(U);if(!U.themeLoaded){U.checkThemeApplied()}return U});
//# sourceMappingURL=ThemeManager.js.map