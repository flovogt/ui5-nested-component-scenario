/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./PluginBase","sap/ui/core/Core"],function(e,t){"use strict";var n=e.extend("sap.m.plugins.CopyProvider",{metadata:{library:"sap.m",properties:{extractData:{type:"function",invalidate:false},copySparse:{type:"boolean",defaultValue:false,invalidate:false},excludeContext:{type:"function",invalidate:false}},events:{copy:{allowPreventDefault:true,parameters:{data:{type:"any[][]"}}}}}});function r(e){return e!=null}function a(e){if(r(e)){var t=String(e);return/\n|\r|\t/.test(t)?'"'+t.replaceAll('"','""')+'"':t}else{return""}}function o(e){var t=e.map(function(e){return e.map(a).join("\t")}).join("\n");return navigator.clipboard.writeText(t)}n.prototype.isApplicable=function(){if(!navigator.clipboard){throw new Error(this+" requires a secure context in order to access the clipboard API.")}else if(!this.getExtractData()){throw new Error("extractData property must be defined for "+this)}else{return true}};n.prototype.onActivate=function(e){this._oDelegate={onkeydown:this.onkeydown};e.addEventDelegate(this._oDelegate,this)};n.prototype.onDeactivate=function(e){e.removeEventDelegate(this._oDelegate,this);this._oDelegate=null};n.prototype.getSelectionData=function(){var n=this.getControl();var a=this.getExtractData();if(!n||!a||!navigator.clipboard){return[]}var o=this.getConfig("selectableColumns",n);if(!o.length){return[]}if(n.getParent().isA("sap.ui.mdc.Table")){o=o.map(function(e){return t.byId(e.getId().replace(/\-innerColumn$/,""))})}var i=[];var l=[];var s=this.getCopySparse();var c=this.getExcludeContext();var u=e.getPlugin(n,"sap.m.plugins.CellSelector");var p=u&&u.getSelectionRange();var f=p?u.getSelectedRowContexts():[];var g=Boolean(f.length);var d=g||s;var v=this.getConfig("selectedContexts",n,d);if(g){f=Array(p.from.rowIndex).concat(f);Object.assign(l,v,f)}else{l=v}for(var h=0;h<l.length;h++){var y=l[h];if(!y){if(s&&i.length){i.push(Array(i[0].length))}}else if(c&&c(y)){continue}else{var C=[];var m=y==v[h];o.forEach(function(e,t){if(m||t>=p.from.colIndex&&t<=p.to.colIndex){var n=a(y,e);if(r(n)){C.push[Array.isArray(n)?"apply":"call"](C,n)}}else if(v.length){C.push(undefined)}});if(s||C.some(r)){i.push(C)}}}return i};n.prototype.copySelectionData=function(e){var t=this.getSelectionData();if(!t.length||e&&!this.fireCopy({data:t},true)){return Promise.resolve()}return o(t)};n.prototype.onkeydown=function(e){if(e.isMarked()||e.code!="KeyC"||!(e.ctrlKey||e.metaKey)||!e.target.matches(this.getConfig("allowForCopySelector"))){return}e.setMarked();e.preventDefault();this.copySelectionData(true)};e.setConfigs({"sap.m.Table":{allowForCopySelector:".sapMLIBFocusable,.sapMLIBSelectM,.sapMLIBSelectS",selectedContexts:function(e,t){var n=[];var r=e.getBindingInfo("items");e.getItems(true).forEach(function(e,a){if(e.isSelectable()&&e.getVisible()){if(e.getSelected()){var o=r?e.getBindingContext(r.model):e;var i=t?a:n.length;n[i]=o}}});return n},selectableColumns:function(e){return e.getColumns(true).filter(function(e){return e.getVisible()&&(e.isPopin()||!e.isPopin()&&!e.isHidden())})}},"sap.ui.table.Table":{allowForCopySelector:".sapUiTableCell",selectedContexts:function(t,n){var r=[];var a=e.getPlugin(t,"sap.ui.table.plugins.SelectionPlugin")||t;a.getSelectedIndices().forEach(function(e){var a=t.getContextByIndex(e);if(a){var o=n?e:r.length;r[o]=a}});return r},selectableColumns:function(e){return e.getColumns().filter(function(e){return e.getDomRef()})}}},n);return n});
//# sourceMappingURL=CopyProvider.js.map