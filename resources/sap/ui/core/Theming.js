/*!
 * copyright
 */
sap.ui.define(["sap/base/assert","sap/base/config","sap/base/Event","sap/base/Eventing","sap/base/future","sap/base/Log","sap/base/i18n/Localization","sap/base/util/deepEqual","sap/ui/core/theming/ThemeHelper"],function(e,t,n,i,a,o,s,r,c){"use strict";const h=t.getWritableInstance();const l=new i;const g=document.querySelector("link[rel=icon]")?.getAttribute("href");let p;const f={getTheme:()=>{let e=h.get({name:"sapTheme",type:h.Type.String,defaultValue:h.get({name:"sapUiTheme",type:h.Type.String,external:true}),external:true});if(e===""){e=c.validateAndFallbackTheme()}const t=e.indexOf("@");if(t>=0){const n=T(e.slice(t+1));e=t>0?e.slice(0,t):e;if(n!==f.getThemeRoot(e)){f.setThemeRoot(e,n)}}e=c.validateAndFallbackTheme(e,f.getThemeRoot(e));return e},setTheme:e=>{if(e&&e.indexOf("@")!==-1){throw new TypeError("Providing a theme root as part of the theme parameter is not allowed.")}const t=f.getTheme();h.set("sapTheme",e);const n=f.getTheme();const i=t!==n;if(i){const e={theme:{new:n,old:t}};m(e)}if(!p&&i){u({theme:n})}},getThemeRoot:(e,t)=>{const n=h.get({name:"sapUiThemeRoots",type:h.Type.MergedObject});let i;e??=f.getTheme();if(n[e]&&typeof n[e]==="string"){i=n[e]}else if(n[e]&&typeof n[e]==="object"){i=n[e][t]||n[e][""]}return i},setThemeRoot:(t,n,i,a)=>{e(typeof t==="string","sThemeName must be a string");e(typeof n==="string","sThemeBaseUrl must be a string");const o={name:"sapUiThemeRoots",type:h.Type.MergedObject};const s=h.get(Object.assign(o,{defaultValue:{}}));const c=h.get(Object.assign(o,{defaultValue:{}}));if(typeof i==="boolean"){a=i;i=undefined}c[t]??={};if(typeof c[t]==="string"){c[t]={"":c[t]};s[t]={"":s[t]}}if(i){for(let e=0;e<i.length;e++){const a=i[e];c[t][a]=n}}else{c[t][""]=n}if(!r(s,c)){const e={};h.set("sapUiThemeRoots",c);if(i){e["themeRoots"]={new:Object.assign({},c[t]),old:Object.assign({},s[t])}}else{e["themeRoots"]={new:n,old:s[t]?.[""]}}e["themeRoots"].forceUpdate=a&&t===f.getTheme();m(e)}},getFavicon:async()=>{const e=g||sap.ui.require.toUrl("sap/ui/core/themes/base/icons/favicon.ico");const t=h.get({name:"sapUiFavicon",type:e=>{const t=e.toString();if(["","false"].includes(t.toLowerCase())){return false}else if(["x","true"].includes(t.toLowerCase())){return true}if(!e||new URL(e,window.location.origin).href.startsWith(window.location.origin)){return t}else{o.error("Absolute URLs are not allowed for favicon. The configured favicon will be ignored.",undefined,"sap.ui.core.theming.Theming");return true}}});if(!t){return t}if(typeof t==="string"){return t}else if(p&&!c.isStandardTheme(f.getTheme())){const t=await new Promise(e=>{sap.ui.require(["sap/ui/core/theming/Parameters"],t=>{const n=t.get({name:"sapUiFavicon",_restrictedParseUrls:true,callback:t=>{e(t)}});if(n!==undefined){e(n)}})});return t||e}return e},setFavicon:async e=>{if(typeof e==="string"&&!new URL(e,window.location.origin).href.startsWith(window.location.origin)){throw new TypeError("Path to favicon must be relative to the current origin")}h.set("sapUiFavicon",e);const t=await f.getFavicon();if(t){await new Promise((e,n)=>{sap.ui.require(["sap/ui/util/Mobile"],n=>{n.setIcons({favicon:t});e()},n)})}else{document.querySelector("link[rel=icon]")?.remove()}},attachAppliedOnce:e=>{const t="applied";if(p){if(p.themeLoaded){e.call(null,new n(t,{theme:f.getTheme()}))}else{l.attachEventOnce(t,e)}}else{e.call(null,new n(t,{theme:f.getTheme()}))}},attachApplied:e=>{const t="applied";l.attachEvent(t,e);if(p){if(p.themeLoaded){e.call(null,new n(t,{theme:f.getTheme()}))}}else{e.call(null,new n(t,{theme:f.getTheme()}))}},detachApplied:e=>{l.detachEvent("applied",e)},attachChange:e=>{l.attachEvent("change",e)},detachChange:e=>{l.detachEvent("change",e)},attachThemeScopingChanged:e=>{l.attachEvent("themeScopingChanged",e)},detachThemeScopingChanged:e=>{l.detachEvent("themeScopingChanged",e)},fireThemeScopingChanged:e=>{l.fireEvent("themeScopingChanged",e)},notifyContentDensityChanged:()=>{u({theme:f.getTheme()})},registerThemeManager:e=>{p=e;p._attachThemeApplied(function(e){u(n.getParameters(e))});s.attachChange(function(e){var t=e.rtl;if(t!==undefined){p._updateThemeUrls(f.getTheme())}})}};function m(e){if(e){l.fireEvent("change",e)}}function u(e){l.fireEvent("applied",e)}function d(e,t){const n=h.get({name:"sapAllowedThemeOrigins",type:h.Type.String});return!!n?.split(",").some(n=>{try{n=t&&!n.startsWith("//")?"//"+n:n;return n==="*"||e===new URL(n.trim(),window.location.href).origin}catch(e){a.errorThrows("sapAllowedThemeOrigins provides invalid theme origin: "+n,{cause:e});return false}})}function T(e){const t=e.startsWith("//");let n,i;try{n=new URL(e,window.location.href);n.search="";if(n.origin&&d(n.origin,t)){i=n.toString()}else{n=new URL(n.pathname,window.location.href);i=n.toString()}if(t){i=i.replace(n.protocol,"")}i+=(i.endsWith("/")?"":"/")+"UI5/"}catch(e){}return i}f.attachApplied(()=>{f.getFavicon().then(e=>{if(e){sap.ui.require(["sap/ui/util/Mobile"],t=>{t.setIcons({favicon:e})})}})});return f});
//# sourceMappingURL=Theming.js.map