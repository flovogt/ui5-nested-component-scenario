/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/m/library","sap/ui/core/Element","sap/ui/core/util/File","sap/ui/Device","sap/m/upload/UploaderHttpRequestMethod","sap/m/upload/UploadItem"],function(e,t,a,n,o,s,r){"use strict";var i=a.extend("sap.m.upload.UploaderTableItem",{metadata:{library:"sap.m",publicMethods:["uploadItem","downloadItem"],properties:{uploadUrl:{type:"string",defaultValue:null},downloadUrl:{type:"string",defaultValue:null},httpRequestMethod:{type:"sap.m.upload.UploaderHttpRequestMethod",defaultValue:s.Post},useMultipart:{type:"boolean",defaultValue:false}},events:{uploadStarted:{parameters:{item:{type:"any"}}},uploadProgressed:{parameters:{item:{type:"any"},loaded:{type:"int"},total:{type:"int"}}},uploadCompleted:{parameters:{item:{type:"any"},responseXHR:{type:"object"}}},uploadTerminated:{parameters:{item:{type:"sap.m.upload.UploadItem"}}}}}});i.prototype.init=function(){this._mRequestHandlers={}};i.uploadFile=function(e,t,a){var n=new window.XMLHttpRequest;var s=this.getHttpRequestMethod();return new Promise(function(r,i){n.open(s,t,true);if((o.browser.edge||o.browser.internet_explorer)&&e.type&&n.readyState===1){n.setRequestHeader("Content-Type",e.type)}if(a){a.forEach(function(e){n.setRequestHeader(e.getKey(),e.getText())})}n.onreadystatechange=function(){if(this.readyState===window.XMLHttpRequest.DONE){if(this.status===200){r(this)}else{i(this)}}};n.send(e)})};i.prototype.uploadItem=function(e,t){var a=new window.XMLHttpRequest,n=e.getFileObject(),s=this,r={xhr:a,item:e},i=this.getHttpRequestMethod(),d=e.getUploadUrl()||this.getUploadUrl();const l=()=>!window.navigator.onLine;const p=()=>{s.fireUploadCompleted({item:e,responseXHR:{response:null,responseXML:null,responseText:JSON.stringify({error:"Internet is offline. Please check your connection and try again."}),readyState:4,status:0,headers:""}})};a.open(i,d,true);if((o.browser.edge||o.browser.internet_explorer)&&n.type&&a.readyState===1){a.setRequestHeader("Content-Type",n.type)}if(t){t.forEach(function(e){a.setRequestHeader(e.getKey(),e.getText())})}a.upload.addEventListener("progress",function(t){s.fireUploadProgressed({item:e,loaded:t.loaded,total:t.total,aborted:false})});a.onreadystatechange=function(){var t=s._mRequestHandlers[e.getId()],a={};if(this.readyState===window.XMLHttpRequest.DONE&&!t.aborted){a={response:this.response,responseXML:this.responseXML,responseText:this.responseText,readyState:this.readyState,status:this.status,headers:this.getAllResponseHeaders()};s.fireUploadCompleted({item:e,responseXHR:a})}};if(this.getUseMultipart()){var u=new window.FormData;var f=n?n.name:null;if(n instanceof window.Blob&&f){u.append(f,n,n.name)}else{u.append(f,n)}u.append("_charset_","UTF-8");n=u;this._mRequestHandlers[e.getId()]=r;if(l()){this.fireUploadStarted({item:e});p()}else{a.send(n);this.fireUploadStarted({item:e})}}else{this._mRequestHandlers[e.getId()]=r;if(l()){this.fireUploadStarted({item:e});p()}else{a.send(n);this.fireUploadStarted({item:e})}}};i.prototype.download=function(a,s,i){var d=this.getDownloadUrl()||a.getUrl();if(o.browser.name==="sf"){i=false}if(!a.getUrl()){e.warning("Items to download do not have a URL.");return false}else if(i){var l=null,p=new window.XMLHttpRequest;p.open("GET",d);s.forEach(function(e){p.setRequestHeader(e.getKey(),e.getText())});p.responseType="blob";p.onload=function(){let e=r;if(a instanceof r){e=r}var t=a.getFileName(),o=e._splitFileName(t,false);l=p.response;if(l instanceof window.Blob){const e=`${o.name}.${o.extension}`;this._saveAsFile(l,e)}else if(typeof l==="string"){n.save(l,o.name,o.extension,a.getMediaType(),"utf-8")}}.bind(this);p.send();return true}else{t.URLHelper.redirect(d,true);return true}};i.prototype.terminateItem=function(e){var t=this._mRequestHandlers[e.getId()],a=this;t.xhr.onabort=function(){t.aborted=false;a.fireUploadTerminated({item:e})};t.aborted=true;t.xhr.abort()};i.prototype._saveAsFile=function(e,t){let a;if(!(e instanceof Blob)){return}const n=document.createElement("a");const o="download"in n;if(o){a=function(e,t){n.download=t;n.href=window.URL.createObjectURL(e);n.dispatchEvent(new window.MouseEvent("click"))}}function s(e,t){const a="noopener,noreferrer";return window.open(e,t,a)}if(typeof a==="undefined"){a=function(e){const t=new window.FileReader;t.onloadend=function(){const e=t.result.replace(/^data:[^;]*;/,"data:attachment/file;");const a=s(e,"_blank");if(!a){window.location.href=e}};t.readAsDataURL(e)}}a(e,t)};return i});
//# sourceMappingURL=UploaderTableItem.js.map