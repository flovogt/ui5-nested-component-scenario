/*
* ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["sap/ui/core/Control","sap/m/Button","sap/m/Bar","sap/m/Title","sap/m/MessageBox","sap/ui/Device","sap/m/Dialog","sap/m/ResponsivePopover","sap/m/p13n/Container","sap/m/p13n/AbstractContainerItem","sap/m/library"],function(t,e,n,o,i,r,s,a,p,l,h){"use strict";var c=h.P13nPopupMode;var u=t.extend("sap.m.p13n.Popup",{metadata:{properties:{title:{type:"string"},mode:{type:"sap.m.P13nPopupMode",defaultValue:c.Dialog},warningText:{type:"string"},reset:{type:"function"}},aggregations:{panels:{type:"sap.m.p13n.IContent",multiple:true},additionalButtons:{type:"sap.m.Button",multiple:true}},events:{close:{reason:{type:"string"}}}},renderer:{apiVersion:2,render:function(t,e){t.openStart("div",e);t.style("height","100%");t.openEnd();t.renderControl(e.getAggregation("_content"));t.close("div")}}});u.prototype.init=function(){t.prototype.init.apply(this,arguments);this._aPanels=[]};u.prototype.isOpen=function(){return!!this._bIsOpen};u.prototype.setMode=function(t){this.setProperty("mode",t);if(this._oPopup){this._oPopup.removeAllContent();this._oPopup.destroy();var e=this._createContainer();this.addDependent(e);this._oPopup=e}return this};u.prototype.open=function(t,e){if(!t){throw new Error("Please provide a source control!")}if(!this._oPopup){var n=this._createContainer(e);this.addDependent(n);this._oPopup=n}if(this.getMode()==="Dialog"){this._oPopup.open()}else{this._oPopup.openBy(t)}this._bIsOpen=true};u.prototype.addPanel=function(t){this._getContainer().addView(new l({key:t.getId(),text:t.getTitle(),content:t}));this._aPanels.push(t);return this};u.prototype.removePanel=function(t){this._aPanels.splice(this._aPanels.indexOf(t),1);this._getContainer().removeView(this._getContainer().getView(t.getId()));return this};u.prototype.getPanels=function(){return this._aPanels};u.prototype._createContainer=function(t){t=t?t:{};return this["_create"+this.getMode()].call(this,t)};u.prototype._createResponsivePopover=function(t){var e=new a(this.getId()+"-responsivePopover",{title:this.getTitle(),horizontalScrolling:t.hasOwnProperty("horizontalScrolling")?t.horizontalScrolling:false,verticalScrolling:false,contentWidth:t.contentWidth?t.contentWidth:"30rem",resizable:t.hasOwnProperty("resizable")?t.resizable:true,contentHeight:t.contentHeight?t.contentHeight:"35rem",placement:t.placement?t.placement:"Bottom",content:this._getContainer()});e.setCustomHeader(this._createTitle());return e};u.prototype._createDialog=function(t){var n=sap.ui.getCore().getLibraryResourceBundle("sap.m");var o=new s(this.getId()+"-dialog",{title:this.getTitle(),horizontalScrolling:t.hasOwnProperty("horizontalScrolling")?t.horizontalScrolling:false,verticalScrolling:false,contentWidth:t.contentWidth?t.contentWidth:"40rem",contentHeight:t.contentHeight?t.contentHeight:"55rem",draggable:true,resizable:true,stretch:r.system.phone,content:this._getContainer(),buttons:[new e(this.getId()+"-confirmBtn",{text:t.confirm&&t.confirm.text?t.confirm.text:n.getText("p13n.POPUP_OK"),type:"Emphasized",press:function(){this._onClose(o,"Ok")}.bind(this)}),new e(this.getId()+"-cancelBtn",{text:n.getText("p13n.POPUP_CANCEL"),press:function(){this._onClose(o,"Cancel")}.bind(this)})]});o.setCustomHeader(this._createTitle());this.getAdditionalButtons().forEach(function(t){o.addButton(t)});return o};u.prototype._createTitle=function(){var t=this.getReset();var r=this.getTitle();var s=this.getWarningText();var a;if(t){a=new n({contentLeft:[new o({text:r})]});a.addContentRight(new e(this.getId()+"-resetBtn",{text:sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("p13n.POPUP_RESET"),press:function(e){var n=e.getSource().getParent().getParent();var o=n.getParent();var r=s;i.warning(r,{actions:[i.Action.OK,i.Action.CANCEL],emphasizedAction:i.Action.OK,onClose:function(e){if(e===i.Action.OK){n.getButtons()[0].focus();t(o)}}})}}))}return a};u.prototype._getContainer=function(t){if(!this._oContainer){this._oContainer=new p}if(this._oContainer.getViews().length>1){this._oContainer.switchView(this._oContainer.getViews()[1].getKey())}return this._oContainer};u.prototype._onClose=function(t,e){t.close();this._bIsOpen=false;this.fireClose({reason:e})};u.prototype.exit=function(){if(this._oPopup){this._oPopup.destroy()}this._aPanels=null};return u});