/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/m/ResponsivePopover","sap/m/Button","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/m/library","sap/ui/core/Control","sap/ui/core/Core","sap/ui/thirdparty/jquery","sap/base/strings/capitalize","sap/m/p13n/AbstractContainerItem","sap/m/p13n/Container","sap/m/table/ColumnMenuRenderer"],function(t,e,i,o,n,r,s,a,g,c,u,p){"use strict";var l=r.extend("sap.m.table.ColumnMenu",{metadata:{library:"sap.m",interfaces:["sap.ui.core.IColumnHeaderMenu"],aggregations:{quickActions:{type:"sap.m.table.QuickActionBase"},items:{type:"sap.m.table.ItemBase"},_quickActions:{type:"sap.m.table.QuickActionBase",visibility:"hidden"},_items:{type:"sap.m.table.ItemBase",visibility:"hidden"}}}});var h="$default";var f=sap.ui.core.aria.HasPopup.Dialog;l.prototype.applySettings=function(t){if(t){this._addAllToPrivateAggregation(t,"_quickActions");this._addAllToPrivateAggregation(t,"_items")}r.prototype.applySettings.apply(this,arguments)};l.prototype.openBy=function(t){if(!this.getParent()){s.getUIArea(s.getStaticAreaRef()).addContent(this,true)}this._initPopover();if(!this._oItemsContainer){this._initItemsContainer()}this._oPopover.openBy(t)};l.prototype.getAriaHasPopupType=function(){return f};l.prototype.close=function(){this._previousView=null;if(this._oPopover){this._oPopover.close()}};l.prototype.exit=function(){r.prototype.exit.apply(this,arguments);if(this._oPopover){delete this._oPopover}if(this._oItemsContainer){delete this._oItemsContainer}};l.prototype._addAllToPrivateAggregation=function(t,e){if(t[e]){t[e].forEach(function(t){this.addAggregation(e,t)}.bind(this));delete t[e]}};l.prototype._initPopover=function(){if(this._oPopover){return}this._oPopover=new t({showArrow:false,showHeader:false,placement:n.PlacementType.Bottom,content:new d({control:this,height:true}),contentWidth:"500px",horizontalScrolling:false,verticalScrolling:false,afterClose:[this.close,this]});this.addDependent(this._oPopover);this._oPopover.addEventDelegate({onAfterRendering:this._focusItem},this);if(this.getItems().length==0&&!this.getAggregation("_items")){this._oPopover.attachAfterOpen(this._focusInitialQuickAction.bind(this))}};l.prototype._initItemsContainer=function(){var t=(this.getAggregation("_items")||[]).reduce(function(t,e){return t.concat(e.getEffectiveItems())},[]);var e=this.getItems().reduce(function(t,e){return t.concat(e.getEffectiveItems())},[]);if(!this._oItemsContainer){this._createItemsContainer()}t.forEach(function(t,e){this._addView(t);e==0&&this._oItemsContainer.addSeparator()}.bind(this));e.forEach(function(t,e){this._addView(t);e==0&&this._oItemsContainer.addSeparator()}.bind(this))};var d=r.extend("sap.m.table.AssociativeControl",{metadata:{final:true,properties:{height:{type:"boolean",defaultValue:false}},associations:{control:{type:"sap.ui.core.Control"}}},renderer:{apiVersion:2,render:function(t,e){t.openStart("div",e);e.getHeight()&&t.style("height","100%");t.openEnd();t.renderControl(sap.ui.getCore().byId(e.getControl()));t.close("div")}}});l.prototype._addView=function(t){var e=new c({content:new d({control:t.getContent(),height:true}),key:t.getId(),text:t.getLabel(),icon:t.getIcon()});this._oItemsContainer.addView(e);this._setItemVisibility(t,t.getVisible())};l.prototype._createItemsContainer=function(){var t=this;this._oBtnCancel=new e({text:this._getResourceText("table.COLUMNMENU_CANCEL"),press:function(){var e=t._oItemsContainer.getCurrentViewKey();if(t._fireEvent(s.byId(e),"cancel")){t.close();t.exit()}}});this._oBtnOk=new e({text:this._getResourceText("table.COLUMNMENU_CONFIRM"),press:function(){var e=t._oItemsContainer.getCurrentViewKey();if(t._fireEvent(s.byId(e),"confirm")){t.close()}}});t._oItemsContainer=new u({listLayout:true,defaultView:h,footer:new i({content:[new o,this._oBtnOk,this._oBtnCancel]}),beforeViewSwitch:function(e){var i=e.getParameters();if(i.target!=="$default"){var o=t._oItemsContainer.getView(i.target);var n=t._getItemFromContainerItem(o);if(n&&n.firePress&&!t._fireEvent(n,"press")){e.preventDefault();return}}},afterViewSwitch:function(e){var i=e.getParameters();this.oLayout.setShowFooter(i.target!=="$default");t._previousView=i.source;if(i.target!=="$default"){var o=t._oItemsContainer.getView(i.target);if(o){var n=t._getItemFromContainerItem(o);t._updateButtonState(n)}else{var o=t._oItemsContainer.getView(i.target);var n=t._getItemFromContainerItem(o);n&&n.focus();this._oPopover&&this._oPopover.invalidate()}}}});t._oItemsContainer.getHeader().addContentRight(new e({text:this._getResourceText("table.COLUMNMENU_RESET"),press:function(){t._fireEvent(s.byId(t._oItemsContainer.getCurrentViewKey()),"reset",false)}}));this._oPopover.addDependent(t._oItemsContainer);t.addDependent(t._oItemsContainer)};l.prototype._fireEvent=function(t,e,i){var o=t["on"+g(e)];if(i!==false){var n=a.Event(e);o.call(t,n);return!n.isDefaultPrevented()}else{o.call(t);return true}};l.prototype._getResourceText=function(t,e){this.oResourceBundle=this.oResourceBundle?this.oResourceBundle:sap.ui.getCore().getLibraryResourceBundle("sap.m");return t?this.oResourceBundle.getText(t,e):this.oResourceBundle};l.prototype._getItemFromContainerItem=function(t){var e=this.getAggregation("_items")&&this.getAggregation("_items").find(function(e){return e.getId()==t.getKey()});if(!e){e=this.getAggregation("items")&&this.getAggregation("items").find(function(e){return e.getId()==t.getKey()})}return e};l.prototype._updateButtonState=function(t){this._oItemsContainer.getHeader().getContentRight()[0].setEnabled(t.getButtonSettings()["reset"]["enabled"]);this._oItemsContainer.getHeader().getContentRight()[0].setVisible(t.getButtonSettings()["reset"]["visible"]);this._oBtnOk.setVisible(t.getButtonSettings()["confirm"]["visible"]);this._oBtnCancel.setVisible(t.getButtonSettings()["cancel"]["visible"])};l.prototype._focusItem=function(){if(this._previousView==h){this._oItemsContainer._getNavBackBtn().focus()}else{var t=this._oItemsContainer._getNavigationList().getItems().find(function(t){return t.getVisible()&&t._key===this._previousView}.bind(this));t&&t.focus()}};l.prototype._focusInitialQuickAction=function(){if(this.getItems().length==0&&!this.getAggregation("_items")){var t=[];if(this.getAggregation("_quickActions")){t=this.getAggregation("_quickActions")[0].getEffectiveQuickActions()}else if(this.getQuickActions().length>0){t=this.getQuickActions()[0].getEffectiveQuickActions()}t.length>0&&t[0].getContent().focus()}};l.prototype._setItemVisibility=function(t,e){var i=this._oItemsContainer._getNavigationList().getItems();var o=i.find(function(e){return e._key==t.getId()});o&&o.setVisible(e)};return l});