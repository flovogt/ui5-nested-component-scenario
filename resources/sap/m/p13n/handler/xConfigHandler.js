/*!
 * OpenUI5
 * (c) Copyright 2009-2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/m/p13n/Engine","sap/m/p13n/modules/xConfigAPI"],(e,t)=>{"use strict";const n={};const a=(e,t)=>{const n=t=>{if(e._pQueue===t){delete e._pQueue}};e._pQueue=e._pQueue instanceof Promise?e._pQueue.then(t):t();e._pQueue.then(n.bind(null,e._pQueue));return e._pQueue};function o(t,n){if(t.isA){e.getInstance().trace(t,{selectorElement:t,changeSpecificData:{changeType:n.getChangeType(),content:n.getContent()}});if(!t._pPendingModification){t._pPendingModification=e.getInstance().waitForChanges(t).then(()=>{e.getInstance().fireStateChange(t);e.getInstance().clearTrace(t);delete t._pPendingModification})}}}function r(e){const t=["add","remove","move","set"];return t.find(t=>e.indexOf(t)===0)}function g(e){const t={add:"remove",remove:"add",move:"move",set:"set"};const n=r(e);return t[n]}n.createHandler=t=>{if(!t||!t.hasOwnProperty("property")){throw new Error("Please provide a map containing the affected aggregation and property name!")}const n=t.property;let i;return{changeHandler:{applyChange:function(g,s,c){const p=g.getContent().persistenceIdentifier;const f=e.getInstance().getController(s,g.getChangeType(),p);if(p&&f.getPersistenceIdentifier()!==p){return Promise.resolve(false)}return a(s,()=>e.getInstance().readXConfig(s,{propertyBag:c}).then(async a=>{const o=g.getContent();const f=r(g.getChangeType());i=g.getContent().targetAggregation;const u={key:g.getContent().key};t.additionalProperties?.forEach(e=>{if(typeof e==="string"&&o[e]!==undefined){u[e]=o[e]}});if(p){u.persistenceIdentifier=p}if(f!=="set"){u.value=f!=="add"}else{u.value=null}if((!a||!(a?.aggregations?.[i]?.length>0))&&typeof t.getCurrentState=="function"){const e=await(t.getCurrentState?.(s,a,i,g,c));if(e){const t=e.find((e,t)=>e.key===g.getContent().key);u.index=e.indexOf(t)}}u.targetAggregation=g.getContent().targetAggregation;const d=a?.aggregations?.[i]?.[g.getContent().key];if(d){if(d?.[n]){u.value=a.aggregations[i][g.getContent().key][n]}u.index=a.aggregations[i][g.getContent().key].position!==undefined?a.aggregations[i][g.getContent().key].position:u.index}g.setRevertData(u);const y={property:n,key:g.getContent().key,value:g.getContent(),operation:f,changeType:g.getChangeType(),propertyBag:c,markAsModified:true};if(t.aggregationBased){y.controlMeta={aggregation:i}}return e.getInstance().enhanceXConfig(s,y)}).then(e=>{if(!e){return}o(s,g)}))},completeChangeContent:function(e,t,n){},revertChange:function(a,r,s){const c=g(a.getChangeType());i=a.getContent().targetAggregation;const p={controlMeta:{aggregation:i,property:n},property:n,operation:c,changeType:a.getChangeType(),key:a.getRevertData().key,value:a.getRevertData(),propertyBag:s};if(t.aggregationBased){p.controlMeta={aggregation:i}}return e.getInstance().enhanceXConfig(r,p).then(e=>{if(!e){return}a.resetRevertData();o(r,a)})}},layers:{USER:true}}};return n});
//# sourceMappingURL=xConfigHandler.js.map